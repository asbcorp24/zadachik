<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Transfer Learning ¬´–¥–ª—è –¥—É—Ä–∞—á–∫–æ–≤¬ª</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 0 15px;
      line-height: 1.4;
    }
    h1, h2 { text-align: center; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0 20px;
    }
    th, td {
      border: 1px solid #888;
      padding: 6px 8px;
      text-align: center;
    }
    th { background: #eee; }
    .controls {
      text-align: center;
      margin: 15px 0;
    }
    .controls button {
      margin: 0 6px;
      padding: 6px 12px;
      font-size: 1rem;
    }
    #log {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      font-family: monospace;
      white-space: pre-line;
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body>

  <h1>Transfer Learning: Feature Extractor + New Head</h1>
  <p style="text-align:center;">
    üìö –ú–æ–¥–µ–ª—å —É–∂–µ —É–º–µ–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏ (–∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å),<br>
    –º—ã –¥–æ–æ–±—É—á–∞–µ–º —Ç–æ–ª—å–∫–æ ¬´–≥–æ–ª–æ–≤—É¬ª (–Ω–æ–≤—ã–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä) –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–π –≤—ã–±–æ—Ä–∫–µ.
  </p>

  <h2>–î–∞–Ω–Ω—ã–µ</h2>
  <p>–£ –Ω–∞—Å –µ—Å—Ç—å 4 –Ω–æ–≤—ã—Ö –ø—Ä–∏–º–µ—Ä–∞ (x, y) –∏ –º–µ—Ç–∫–∏ (0 –∏–ª–∏ 1):</p>
  <table id="dataTable">
    <tr><th>#</th><th>x</th><th>y</th><th>label</th><th>u=x+y</th><th>v=x‚àíy</th><th>z=w‚ÇÅu+w‚ÇÇv+b</th><th>sigmoid(z)</th><th>error=y‚àípred</th></tr>
    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º -->
  </table>

  <div class="controls">
    <button id="extractBtn">1. Extract Features</button>
    <button id="trainBtn" disabled>2. Train Head Step</button>
    <button id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å</button>
  </div>

  <h2>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–æ–ª–æ–≤—ã (–ª–∏–Ω–µ–π–Ω—ã–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä)</h2>
  <p>–í–µ—Å w‚ÇÅ = <span id="w1">0.00</span>, w‚ÇÇ = <span id="w2">0.00</span>, b = <span id="b">0.00</span></p>
  <p>Learning rate Œ± = 0.1</p>

  <h2>–ñ—É—Ä–Ω–∞–ª –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤</h2>
  <div id="log">–ñ—É—Ä–Ω–∞–ª: –Ω–∞–∂–º–∏—Ç–µ ¬´Extract Features¬ª, —á—Ç–æ–±—ã –≤—ã—á–∏—Å–ª–∏—Ç—å u –∏ v.</div>

<script>
  // –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  const rawData = [
    {x:1, y:2, label:0},
    {x:2, y:1, label:0},
    {x:3, y:3, label:1},
    {x:4, y:5, label:1}
  ];
  let data = [];

  // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–æ–ª–æ–≤—ã
  let w1 = 0, w2 = 0, b = 0;
  const alpha = 0.1;

  const table = document.getElementById('dataTable');
  const extractBtn = document.getElementById('extractBtn');
  const trainBtn   = document.getElementById('trainBtn');
  const resetBtn   = document.getElementById('resetBtn');
  const logEl      = document.getElementById('log');
  const w1Span     = document.getElementById('w1');
  const w2Span     = document.getElementById('w2');
  const bSpan      = document.getElementById('b');

  function sigmoid(z){ return 1/(1+Math.exp(-z)); }

  function renderTable() {
    // –û—á–∏—â–∞–µ–º, –∫—Ä–æ–º–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
    table.innerHTML = `<tr><th>#</th><th>x</th><th>y</th><th>label</th><th>u=x+y</th><th>v=x‚àíy</th><th>z=w‚ÇÅu+w‚ÇÇv+b</th><th>sigmoid(z)</th><th>error=y‚àípred</th></tr>`;
    data.forEach((p,i)=>{
      const row = document.createElement('tr');
      const z = (w1*p.u + w2*p.v + b).toFixed(3);
      const pred = sigmoid(w1*p.u + w2*p.v + b);
      const err = (p.label - pred).toFixed(3);
      row.innerHTML = `
        <td>${i+1}</td>
        <td>${p.x}</td>
        <td>${p.y}</td>
        <td>${p.label}</td>
        <td>${p.u.toFixed(2)}</td>
        <td>${p.v.toFixed(2)}</td>
        <td>${z}</td>
        <td>${pred.toFixed(3)}</td>
        <td>${err}</td>
      `;
      table.appendChild(row);
    });
  }

  function updateParamsDisplay() {
    w1Span.textContent = w1.toFixed(3);
    w2Span.textContent = w2.toFixed(3);
    bSpan.textContent  = b.toFixed(3);
  }

  function log(msg) {
    logEl.textContent = msg + '\n\n' + logEl.textContent;
  }

  // –°–±—Ä–æ—Å
  resetBtn.onclick = () => {
    data = [];
    w1 = 0; w2 = 0; b = 0;
    updateParamsDisplay();
    renderTable();
    logEl.textContent = '–ñ—É—Ä–Ω–∞–ª: –Ω–∞–∂–º–∏—Ç–µ ¬´Extract Features¬ª, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.';
    trainBtn.disabled = true;
  };

  // Extract Features
  extractBtn.onclick = () => {
    data = rawData.map(p => ({
      ...p,
      u: p.x + p.y,
      v: p.x - p.y
    }));
    renderTable();
    log(
      '–®–∞–≥ 1: –ò–∑–≤–ª–µ–∫–ª–∏ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–∑ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–æ–≥–æ —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä–∞:\n' +
      data.map((p,i)=>`  –ü—Ä–∏–º–µ—Ä ${i+1}: u=${p.x}+${p.y}=${p.u}, v=${p.x}-${p.y}=${p.v}`).join('\n')
    );
    trainBtn.disabled = false;
  };

  // Train Head Step
  trainBtn.onclick = () => {
    // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –±–µ—Ä—ë–º –æ–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥ –ø–æ –≤—Å–µ–º –ø—Ä–∏–º–µ—Ä–∞–º (batch=all)
    let msg = '–®–∞–≥ 2: –û–±—É—á–µ–Ω–∏–µ –≥–æ–ª–æ–≤—ã (–≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —à–∞–≥):\n';
    data.forEach((p,i) => {
      const z = w1*p.u + w2*p.v + b;
      const pred = sigmoid(z);
      const error = p.label - pred;
      // –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã
      const gradW1 = error * p.u;
      const gradW2 = error * p.v;
      const gradB  = error;
      msg += `\n–ü—Ä–∏–º–µ—Ä ${i+1}:\n`;
      msg += `  z = ${w1.toFixed(3)}¬∑${p.u.toFixed(2)} + ${w2.toFixed(3)}¬∑${p.v.toFixed(2)} + ${b.toFixed(3)} = ${z.toFixed(3)}\n`;
      msg += `  pred = sigmoid(z) = ${pred.toFixed(3)}\n`;
      msg += `  error = y - pred = ${p.label} - ${pred.toFixed(3)} = ${error.toFixed(3)}\n`;
      msg += `  gradW1 = error¬∑u = ${error.toFixed(3)}¬∑${p.u.toFixed(2)} = ${gradW1.toFixed(3)}\n`;
      msg += `  gradW2 = error¬∑v = ${error.toFixed(3)}¬∑${p.v.toFixed(2)} = ${gradW2.toFixed(3)}\n`;
      msg += `  gradB  = error = ${gradB.toFixed(3)}\n`;
      // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
      w1 += alpha * gradW1;
      w2 += alpha * gradW2;
      b  += alpha * gradB;
      msg += `  –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:\n`;
      msg += `    w1_new = w1_old + Œ±¬∑gradW1 = ‚Ä¶ = ${w1.toFixed(3)}\n`;
      msg += `    w2_new = ‚Ä¶ = ${w2.toFixed(3)}\n`;
      msg += `    b_new  = ‚Ä¶ = ${b.toFixed(3)}\n`;
    });
    updateParamsDisplay();
    renderTable();
    log(msg);
  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  resetBtn.onclick();
</script>

</body>
</html>
