<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Unsupervised Learning Demo ¬´–¥–ª—è –¥—É—Ä–∞—á–∫–æ–≤¬ª</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 20px auto;
      line-height: 1.4;
      padding: 0 15px;
    }
    h1, h2 { text-align: center; }
    section {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 30px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
      margin: 10px 0;
    }
    .controls label {
      font-size: 0.95rem;
    }
    .controls input, .controls select, .controls button {
      font-size: 1rem;
      padding: 4px 8px;
    }
    canvas {
      display: block;
      margin: 0 auto;
      border: 1px solid #ccc;
      background: #fff;
    }
    #log-kmeans, #log-pca {
      background: #fff;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-line;
      height: 150px;
      overflow-y: auto;
    }
  </style>
</head>
<body>

  <h1>–û–±—É—á–µ–Ω–∏–µ –±–µ–∑ —É—á–∏—Ç–µ–ª—è (Unsupervised Learning)</h1>
  <p style="text-align:center;">üè´üëÄüîç ‚Äî –ò–ò —Å–∞–º –∏—â–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤!</p>

  <!-- K-means Clustering Demo -->
  <section>
    <h2>1. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è (K-means)</h2>
    <canvas id="canvasK" width="600" height="400"></canvas>
    <div class="controls">
      <label>–ß–∏—Å–ª–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ K:
        <input type="number" id="kInput" value="3" min="2" max="5">
      </label>
      <button id="initK">–ò–Ω–∏—Ü–∏–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤</button>
      <button id="assignK" disabled>–®–∞–≥: –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ —Ç–æ—á–µ–∫</button>
      <button id="updateK" disabled>–®–∞–≥: –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—Ç—Ä—ã</button>
      <button id="resetK" disabled>–°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>
    <div id="log-kmeans">–ñ—É—Ä–Ω–∞–ª K-means: –∂–º–∏ ¬´–ò–Ω–∏—Ü–∏–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤¬ª. üß≤</div>
  </section>

  <!-- PCA Demo -->
  <section>
    <h2>2. PCA (–£–ø—Ä–æ—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)</h2>
    <canvas id="canvasP" width="600" height="400"></canvas>
    <div class="controls">
      <button id="computePCA">–í—ã—á–∏—Å–ª–∏—Ç—å PCA</button>
      <button id="resetPCA" disabled>–°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>
    <div id="log-pca">–ñ—É—Ä–Ω–∞–ª PCA: –∂–º–∏ ¬´–í—ã—á–∏—Å–ª–∏—Ç—å PCA¬ª. üñºÔ∏èüîç‚û°Ô∏è‚úÇÔ∏è</div>
  </section>

  <script>
  // === –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã ===
  function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
  function distance(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}
  const colors = ['#e63946','#2a9d8f','#457b9d','#f4a261','#8d99ae'];

  // === K-means ===
  const canvasK = document.getElementById('canvasK');
  const ctxK    = canvasK.getContext('2d');
  const logK    = document.getElementById('log-kmeans');
  let pointsK, centroids, assignments, K, stepK;

  function drawK() {
    ctxK.clearRect(0,0,canvasK.width,canvasK.height);
    // —Ç–æ—á–∫–∏
    pointsK.forEach((p,i)=>{
      ctxK.fillStyle = assignments[i]!=null? colors[assignments[i]] : '#666';
      ctxK.beginPath();
      ctxK.arc(p.x,p.y,5,0,2*Math.PI);
      ctxK.fill();
    });
    // —Ü–µ–Ω—Ç—Ä–æ–∏–¥—ã
    centroids.forEach((c,i)=>{
      ctxK.fillStyle = colors[i];
      ctxK.strokeStyle = '#000';
      ctxK.lineWidth = 2;
      ctxK.beginPath();
      ctxK.arc(c.x,c.y,8,0,2*Math.PI);
      ctxK.fill();
      ctxK.stroke();
    });
  }

  document.getElementById('initK').onclick = ()=>{
    K = parseInt(document.getElementById('kInput').value,10);
    // –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º 30 —Å–ª—É—á–∞–π–Ω—ã—Ö —Ç–æ—á–µ–∫
    pointsK = Array.from({length:30},()=>({
      x: randInt(20,580),
      y: randInt(20,380)
    }));
    // —Ä–∞–Ω–¥–æ–º–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º —Ü–µ–Ω—Ç—Ä–æ–∏–¥—ã
    centroids = [];
    for(let i=0;i<K;i++){
      centroids.push({
        x: randInt(50,550),
        y: randInt(50,350)
      });
    }
    assignments = Array(pointsK.length).fill(null);
    stepK = 0;
    drawK();
    logK.textContent = `–®–∞–≥ ${stepK}: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ${K} —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤ —Å–ª—É—á–∞–π–Ω–æ.\n\n` +
      centroids.map((c,i)=>`–¶${i}: (${c.x},${c.y})`).join('\n') + '\n\n' +
      `–ù–∞–∂–º–∏ ¬´–®–∞–≥: –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ —Ç–æ—á–µ–∫¬ª.`;
    document.getElementById('assignK').disabled = false;
    document.getElementById('updateK').disabled = true;
    document.getElementById('resetK').disabled  = false;
  };

  document.getElementById('assignK').onclick = ()=>{
    stepK++;
    logK.textContent = `–®–∞–≥ ${stepK}: –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–µ –±–ª–∏–∂–∞–π—à–∏–π —Ü–µ–Ω—Ç–æ–≤.\n`;
    pointsK.forEach((p,i)=>{
      let best = 0, bestD = distance(p,centroids[0]);
      for(let j=1;j<K;j++){
        const d = distance(p,centroids[j]);
        if(d<bestD){ bestD=d; best=j; }
      }
      assignments[i] = best;
      logK.textContent += 
        `–¢–æ—á–∫–∞${i} (${p.x},${p.y}) ‚Üí –¶${best} (d=${bestD.toFixed(1)})\n`;
    });
    drawK();
    document.getElementById('assignK').disabled = true;
    document.getElementById('updateK').disabled = false;
  };

  document.getElementById('updateK').onclick = ()=>{
    stepK++;
    logK.textContent = `–®–∞–≥ ${stepK}: –æ–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—Ç—Ä–æ–∏–¥—ã –ø–æ —Å—Ä–µ–¥–Ω–µ–º—É.\n`;
    centroids.forEach((c,i)=>{
      const clusterPts = pointsK.filter((_,j)=>assignments[j]===i);
      if(clusterPts.length){
        const mx = clusterPts.reduce((s,p)=>s+p.x,0)/clusterPts.length;
        const my = clusterPts.reduce((s,p)=>s+p.y,0)/clusterPts.length;
        logK.textContent += 
          `–¶${i}: —Å—Ç–∞—Ä–æ=(${c.x},${c.y}) ‚Üí –Ω–æ–≤–æ–µ=(${mx.toFixed(1)},${my.toFixed(1)})\n`;
        c.x = mx; c.y = my;
      }
    });
    drawK();
    document.getElementById('assignK').disabled = false;
    document.getElementById('updateK').disabled = true;
  };

  document.getElementById('resetK').onclick = ()=>{
    ctxK.clearRect(0,0,canvasK.width,canvasK.height);
    logK.textContent = '–ñ—É—Ä–Ω–∞–ª K-means: –∂–º–∏ ¬´–ò–Ω–∏—Ü–∏–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤¬ª. üß≤';
    document.getElementById('assignK').disabled = true;
    document.getElementById('updateK').disabled = true;
    document.getElementById('resetK').disabled  = true;
  };

  // === PCA ===
  const canvasP = document.getElementById('canvasP');
  const ctxP    = canvasP.getContext('2d');
  const logP    = document.getElementById('log-pca');
  let dataP;

  function drawP(axis1,axis2){
    ctxP.clearRect(0,0,canvasP.width,canvasP.height);
    // —Ä–∏—Å—É–µ–º —Ç–æ—á–∫–∏
    dataP.forEach(p=>{
      ctxP.fillStyle = '#007ACC';
      ctxP.beginPath();
      ctxP.arc(p[0]*4+300,p[1]*4+200,4,0,2*Math.PI);
      ctxP.fill();
    });
    // —Ä–∏—Å—É–µ–º –æ—Å–∏ PCA
    if(axis1){
      ctxP.strokeStyle='#e63946'; ctxP.lineWidth=2;
      ctxP.beginPath();
      ctxP.moveTo(300,200);
      ctxP.lineTo(300+axis1[0]*60,200-axis1[1]*60);
      ctxP.stroke();
    }
    if(axis2){
      ctxP.strokeStyle='#2a9d8f'; ctxP.lineWidth=2;
      ctxP.beginPath();
      ctxP.moveTo(300,200);
      ctxP.lineTo(300+axis2[0]*60,200-axis2[1]*60);
      ctxP.stroke();
    }
  }

  document.getElementById('computePCA').onclick = ()=>{
    // –ø—Ä–æ—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ: 10 —Ç–æ—á–µ–∫ —Å –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–µ–π
    dataP = [[1,2],[2,4],[3,6],[4,8],[5,10],[6,12],[7,14],[8,16],[9,18],[10,20]];
    // 1) mean
    const mean = [
      dataP.reduce((s,p)=>s+p[0],0)/dataP.length,
      dataP.reduce((s,p)=>s+p[1],0)/dataP.length
    ];
    logP.textContent = `–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(dataP)}\n\n` +
      `1) –°—Ä–µ–¥–Ω–µ–µ (mean): (${mean[0].toFixed(2)}, ${mean[1].toFixed(2)})\n`;
    // 2) —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º
    const centered = dataP.map(p=>[p[0]-mean[0], p[1]-mean[1]]);
    // 3) –∫–æ–≤–∞—Ä–∏–∞—Ü–∏—è 2√ó2
    let c00=0,c01=0,c11=0;
    centered.forEach(p=>{
      c00 += p[0]*p[0];
      c01 += p[0]*p[1];
      c11 += p[1]*p[1];
    });
    c00 /= dataP.length; c01 /= dataP.length; c11 /= dataP.length;
    const cov = [[c00,c01],[c01,c11]];
    logP.textContent +=
      `\n2) –ö–æ–≤–∞—Ä–∏–∞—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞:\n`+
      `  [${cov[0][0].toFixed(2)}  ${cov[0][1].toFixed(2)}]\n`+
      `  [${cov[1][0].toFixed(2)}  ${cov[1][1].toFixed(2)}]\n`;
    // 4) —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–∏—Å–ª–∞/–≤–µ–∫—Ç–æ—Ä—ã –¥–ª—è 2√ó2
    const tr = cov[0][0]+cov[1][1];
    const det = cov[0][0]*cov[1][1] - cov[0][1]*cov[1][0];
    const disc = Math.sqrt(tr*tr - 4*det);
    const Œª1 = (tr+disc)/2, Œª2 = (tr-disc)/2;
    // –≤–µ–∫—Ç–æ—Ä—ã
    function eigvec(l){
      const [a,b] = cov[0];
      if(Math.abs(b)>1e-6){
        return [l-cov[1][1], b];
      } else {
        return [cov[0][1], l-cov[0][0]];
      }
    }
    let v1 = eigvec(Œª1), v2 = eigvec(Œª2);
    // –Ω–æ—Ä–º–∏—Ä–æ–≤–∫–∞
    const norm = v=>{ const n=Math.hypot(v[0],v[1]); return [v[0]/n,v[1]/n]; };
    v1 = norm(v1); v2 = norm(v2);
    logP.textContent +=
      `\n3) Eigenvalues: Œª1=${Œª1.toFixed(2)}, Œª2=${Œª2.toFixed(2)}\n`+
      `   PC1 = [${v1.map(x=>x.toFixed(2)).join(',')}],\n`+
      `   PC2 = [${v2.map(x=>x.toFixed(2)).join(',')}]\n`;
    // –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å
    drawP(v1,v2);
    document.getElementById('resetPCA').disabled = false;
    document.getElementById('computePCA').disabled = true;
  };

  document.getElementById('resetPCA').onclick = ()=>{
    ctxP.clearRect(0,0,canvasP.width,canvasP.height);
    logP.textContent = '–ñ—É—Ä–Ω–∞–ª PCA: –∂–º–∏ ¬´–í—ã—á–∏—Å–ª–∏—Ç—å PCA¬ª. üñºÔ∏èüîç‚û°Ô∏è‚úÇÔ∏è';
    document.getElementById('computePCA').disabled = false;
    document.getElementById('resetPCA').disabled = true;
  };

  </script>

</body>
</html>
