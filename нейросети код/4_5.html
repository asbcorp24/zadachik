<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>MLP Demo ‚Äì –ü—Ä–æ—Å—Ç–∞—è –ø–æ–ª–Ω–æ—Å–≤—è–∑–Ω–∞—è —Å–µ—Ç—å</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 20px auto; line-height: 1.4; }
    h2 { border-bottom: 1px solid #ccc; padding-bottom: 5px; }
    .section { margin-bottom: 20px; padding: 10px; background: #f9f9f9; border-radius: 6px; }
    .controls { display: flex; gap: 20px; flex-wrap: wrap; }
    .control { flex: 1; min-width: 150px; }
    .neuron { display: inline-block; width: 60px; height: 40px; margin: 5px; 
              background: #fff; border: 1px solid #888; border-radius: 4px;
              text-align: center; line-height: 40px; font-weight: bold; }
    button { padding: 8px 16px; font-size: 1rem; }
    .weights { font-size: 0.9rem; color: #555; }
  </style>
</head>
<body>

  <h1>–î–µ–º–æ: –ü–æ–ª–Ω–æ—Å–≤—è–∑–Ω–∞—è —Å–µ—Ç—å (MLP) ¬´–¥–ª—è –¥—É—Ä–∞—á–∫–æ–≤¬ª</h1>

  <div class="section" id="inputs-section">
    <h2>1. –í—Ö–æ–¥—ã (3 —á–∏—Å–ª–∞)</h2>
    <p>–î–≤–∏–≥–∞–π –ø–æ–ª–∑—É–Ω–∫–∏, —á—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É, –¥–æ–∂–¥—å –∏ –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</p>
    <div class="controls">
      <div class="control">
        <label>–¢–µ–º–ø. (¬∞C): <span id="in-temp">25</span></label><br/>
        <input type="range" id="slider-temp" min="0" max="40" value="25">
      </div>
      <div class="control">
        <label>–î–æ–∂–¥—å (–º–º): <span id="in-rain">0</span></label><br/>
        <input type="range" id="slider-rain" min="0" max="20" value="0">
      </div>
      <div class="control">
        <label>–î–µ–Ω—å (1‚Äì7): <span id="in-day">5</span></label><br/>
        <input type="range" id="slider-day" min="1" max="7" value="5">
      </div>
    </div>
  </div>

  <div class="section" id="hidden-section">
    <h2>2. –°–∫—Ä—ã—Ç—ã–π —Å–ª–æ–π (4 –Ω–µ–π—Ä–æ–Ω–∞ + ReLU)</h2>
    <p>–ö–∞–∂–¥—ã–π –Ω–µ–π—Ä–æ–Ω —Å—á–∏—Ç–∞–µ—Ç <em>–≤–∑–≤–µ—à–µ–Ω–Ω—É—é —Å—É–º–º—É</em> + —Å–º–µ—â–µ–Ω–∏–µ, –ø–æ—Ç–æ–º ReLU (–æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ):</p>
    <div id="hidden-neurons">
      <!-- –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è 4 –±–ª–æ–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ -->
    </div>
    <p class="weights">
      <button id="rand-hidden">Randomize hidden weights & biases</button>
    </p>
  </div>

  <div class="section" id="output-section">
    <h2>3. –í—ã—Ö–æ–¥–Ω–æ–π —Å–ª–æ–π (2 –Ω–µ–π—Ä–æ–Ω–∞ + Softmax)</h2>
    <p>–ë–µ—Ä—ë–º 2 —á–∏—Å–ª–∞ –∏–∑ —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–ª–æ—è, —Å—á–∏—Ç–∞–µ–º —Ç–æ–∂–µ –≤–∑–≤–µ—à–µ–Ω–Ω—É—é —Å—É–º–º—É + bias –∏ –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏:</p>
    <div class="controls">
      <div class="control">
        <div class="neuron">üèÉ‚Äç‚ôÇÔ∏è<br/><span id="out-walk">‚Äì</span></div>
        <div class="neuron">üè†<br/><span id="out-home">‚Äì</span></div>
      </div>
    </div>
    <p class="weights">
      <button id="rand-output">Randomize output weights & biases</button>
    </p>
  </div>

  <script>
    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ—Ç–∏
    let wH = []; // —Å–∫—Ä—ã—Ç—ã–π: –º–∞—Ç—Ä–∏—Ü–∞ 3√ó4
    let bH = []; // —Å–∫—Ä—ã—Ç—ã–π: —Å–º–µ—â–µ–Ω–∏—è 4
    let wO = []; // –≤—ã—Ö–æ–¥–Ω–æ–π: –º–∞—Ç—Ä–∏—Ü–∞ 4√ó2
    let bO = []; // –≤—ã—Ö–æ–¥–Ω–æ–π: —Å–º–µ—â–µ–Ω–∏—è 2

    // –ü–æ–ª—É—á–∏—Ç—å –≤—Ö–æ–¥—ã –∏–∑ –ø–æ–ª–∑—É–Ω–∫–æ–≤
    function getInputs() {
      return [
        +document.getElementById('slider-temp').value,
        +document.getElementById('slider-rain').value,
        +document.getElementById('slider-day').value
      ];
    }

    // –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç —Ä—è–¥–æ–º —Å –ø–æ–ª–∑—É–Ω–∫–∞–º–∏
    function bindSliders() {
      const names = ['temp','rain','day'];
      names.forEach(name => {
        const slider = document.getElementById('slider-' + name);
        const display = document.getElementById('in-' + name);
        slider.addEventListener('input', () => {
          display.textContent = slider.value;
          computeAll();
        });
      });
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–µ—Å–æ–≤
    function randMatrix(rows, cols) {
      const M = [];
      for(let i=0;i<rows;i++){
        M.push(Array.from({length:cols},()=> (Math.random()*2-1).toFixed(2)*1));
      }
      return M;
    }
    function randVector(n) {
      return Array.from({length:n},()=> (Math.random()*2-1).toFixed(2)*1);
    }

    function randomizeHidden() {
      wH = randMatrix(3,4);
      bH = randVector(4);
      console.log('Hidden w:',wH,'bH:',bH);
      computeAll();
    }
    function randomizeOutput() {
      wO = randMatrix(4,2);
      bO = randVector(2);
      console.log('Output w:',wO,'bO:',bO);
      computeAll();
    }

    // ReLU
    function relu(x) { return x>0?x:0; }

    // Softmax
    function softmax(arr) {
      const max = Math.max(...arr);
      const exps = arr.map(x=>Math.exp(x-max));
      const sum = exps.reduce((a,b)=>a+b,0);
      return exps.map(v => (v/sum).toFixed(2)*1);
    }

    // –í—ã—á–∏—Å–ª–∏—Ç—å —Å–∫—Ä—ã—Ç—ã–π —Å–ª–æ–π
    function computeHidden(inputs) {
      const hidden = [];
      for(let j=0;j<4;j++){
        let sum = bH[j];
        for(let i=0;i<3;i++){
          sum += inputs[i] * wH[i][j];
        }
        hidden[j] = relu(sum.toFixed(2)*1);
      }
      return hidden;
    }

    // –í—ã—á–∏—Å–ª–∏—Ç—å –≤—ã—Ö–æ–¥–Ω–æ–π —Å–ª–æ–π
    function computeOutput(hidden) {
      const out = [];
      for(let k=0;k<2;k++){
        let sum = bO[k];
        for(let j=0;j<4;j++){
          sum += hidden[j] * wO[j][k];
        }
        out[k] = sum;
      }
      return softmax(out);
    }

    // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    function computeAll() {
      const inputs = getInputs();
      const hidden = computeHidden(inputs);

      // –ü–æ–∫–∞–∑–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–π
      const divH = document.getElementById('hidden-neurons');
      divH.innerHTML = '';
      hidden.forEach((val,i)=> {
        const el = document.createElement('div');
        el.className = 'neuron';
        el.textContent = val;
        divH.appendChild(el);
      });

      // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã—Ö–æ–¥
      const out = computeOutput(hidden);
      document.getElementById('out-walk').textContent = out[0];
      document.getElementById('out-home').textContent = out[1];
    }

    // –ù–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
    bindSliders();
    document.getElementById('rand-hidden').onclick = randomizeHidden;
    document.getElementById('rand-output').onclick = randomizeOutput;
    // –°—Ä–∞–∑—É —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å–∞
    randomizeHidden();
    randomizeOutput();
  </script>
</body>
</html>
