<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Reinforcement Learning Demo ¬´–¥–ª—è –¥—É—Ä–∞—á–∫–æ–≤¬ª</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 20px auto;
      padding: 0 15px;
      line-height: 1.4;
    }
    h1, h2 { text-align: center; }
    .section {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 30px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
    }
    th, td {
      border: 1px solid #888;
      padding: 6px 8px;
      text-align: center;
    }
    th { background: #eee; }
    .controls {
      text-align: center;
      margin: 15px 0;
    }
    .controls select, .controls button {
      font-size: 1rem;
      padding: 6px 12px;
      margin: 0 8px;
    }
    #log {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      font-family: monospace;
      white-space: pre-line;
      max-height: 250px;
      overflow-y: auto;
    }
  </style>
</head>
<body>

  <h1>Reinforcement Learning (Q-learning)</h1>
  <p style="text-align:center;">üê∂‚ú®üçñ‚ùå ‚Äî –∞–≥–µ–Ω—Ç —É—á–∏—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–∞–≥—Ä–∞–¥—ã –∏ —à—Ç—Ä–∞—Ñ—ã</p>

  <div class="section">
    <h2>–û–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –¥–µ–π—Å—Ç–≤–∏—è</h2>
    <p>–°–æ—Å—Ç–æ—è–Ω–∏–µ: <strong>–©–µ–Ω–æ–∫ –≤–∏–¥–∏—Ç –º—è—á–∏–∫</strong></p>
    <p>–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</p>
    <ul>
      <li><strong>Fetch</strong> ‚Äì –ø—Ä–∏–Ω–æ—Å–∏—Ç –º—è—á–∏–∫ (–Ω–∞–≥—Ä–∞–∂–¥–∞–µ–º +2)</li>
      <li><strong>Sit</strong> ‚Äì —Å–∞–¥–∏—Ç—Å—è (–Ω–∞–≥—Ä–∞–∂–¥–∞–µ–º +1)</li>
      <li><strong>Bark</strong> ‚Äì –ª–∞–µ—Ç –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã (—à—Ç—Ä–∞—Ñ ‚àí1)</li>
    </ul>
  </div>

  <div class="section">
    <h2>Q-—Ç–∞–±–ª–∏—Ü–∞</h2>
    <table>
      <tr><th>–î–µ–π—Å—Ç–≤–∏–µ</th><th>Q(s,a)</th></tr>
      <tr><td>Fetch</td><td id="q-fetch">0.00</td></tr>
      <tr><td>Sit</td><td id="q-sit">0.00</td></tr>
      <tr><td>Bark</td><td id="q-bark">0.00</td></tr>
    </table>
    <div class="controls">
      <label>–í—ã–±—Ä–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ:
        <select id="actionSelect">
          <option value="fetch">Fetch</option>
          <option value="sit">Sit</option>
          <option value="bark">Bark</option>
        </select>
      </label>
      <button id="stepButton">–í—ã–ø–æ–ª–Ω–∏—Ç—å —à–∞–≥</button>
      <button id="resetButton">–°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>
    <div id="log">
      –ñ—É—Ä–Ω–∞–ª: –Ω–∞–∂–º–∏—Ç–µ ¬´–í—ã–ø–æ–ª–Ω–∏—Ç—å —à–∞–≥¬ª –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è.
    </div>
  </div>

<script>
  // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Q-learning
  const alpha = 0.1;      // —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è
  const gamma = 0.9;      // —Ñ–∞–∫—Ç–æ—Ä –¥–∏—Å–∫–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Q-–∑–Ω–∞—á–µ–Ω–∏–π
  let Q = { fetch: 0, sit: 0, bark: 0 };
  let stepCount = 0;

  // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
  const qFetch = document.getElementById('q-fetch');
  const qSit   = document.getElementById('q-sit');
  const qBark  = document.getElementById('q-bark');
  const actionSelect = document.getElementById('actionSelect');
  const stepButton   = document.getElementById('stepButton');
  const resetButton  = document.getElementById('resetButton');
  const logEl        = document.getElementById('log');

  function updateTable() {
    qFetch.textContent = Q.fetch.toFixed(2);
    qSit.textContent   = Q.sit.toFixed(2);
    qBark.textContent  = Q.bark.toFixed(2);
  }

  function log(msg) {
    logEl.textContent = msg + '\n\n' + logEl.textContent;
  }

  // –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è
  function getReward(action) {
    if (action === 'fetch') return 2;
    if (action === 'sit')   return 1;
    if (action === 'bark')  return -1;
    return 0;
  }

  // –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–∏–Ω —à–∞–≥ Q-learning
  stepButton.onclick = () => {
    const action = actionSelect.value;
    stepCount++;
    const oldQ = Q[action];
    const reward = getReward(action);
    // –æ–¥–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∑–Ω–∞—á–∏—Ç max_a' Q(s,a') = max of current Q
    const maxQNext = Math.max(Q.fetch, Q.sit, Q.bark);
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Q
    const target = reward + gamma * maxQNext;
    const newQ = oldQ + alpha * (target - oldQ);
    Q[action] = newQ;

    // –õ–æ–≥ —Å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º–∏ —Ä–∞—Å—á–µ—Ç–∞–º–∏
    let msg = `–®–∞–≥ ${stepCount} ‚Äî –¥–µ–π—Å—Ç–≤–∏–µ: ${action.toUpperCase()}\n`;
    msg += `–ù–∞–≥—Ä–∞–¥–∞ R = ${reward}\n`;
    msg += `–°—Ç–∞—Ä–æ–µ Q = ${oldQ.toFixed(2)}\n`;
    msg += `–ú–∞–∫—Å —Å–ª–µ–¥—É—é—â–µ–≥–æ Q = max{${Q.fetch.toFixed(2)}, ${Q.sit.toFixed(2)}, ${Q.bark.toFixed(2)}} = ${maxQNext.toFixed(2)}\n`;
    msg += `–¶–µ–ª–µ–≤–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å: R + Œ≥¬∑maxQ' = ${reward} + ${gamma}¬∑${maxQNext.toFixed(2)} = ${target.toFixed(2)}\n`;
    msg += `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: Q_new = Q_old + Œ±¬∑(target - Q_old)\n`;
    msg += `           = ${oldQ.toFixed(2)} + ${alpha}¬∑(${target.toFixed(2)} - ${oldQ.toFixed(2)}) = ${newQ.toFixed(2)}`;

    updateTable();
    log(msg);
  };

  // –°–±—Ä–æ—Å –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π
  resetButton.onclick = () => {
    Q = { fetch: 0, sit: 0, bark: 0 };
    stepCount = 0;
    updateTable();
    logEl.textContent = '–ñ—É—Ä–Ω–∞–ª: –Ω–∞–∂–º–∏—Ç–µ ¬´–í—ã–ø–æ–ª–Ω–∏—Ç—å —à–∞–≥¬ª –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è.';
  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã
  updateTable();
</script>

</body>
</html>
