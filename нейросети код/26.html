<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–î–µ–º–æ: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è MNIST ¬´–¥–ª—è –¥—É—Ä–∞—á–∫–æ–≤¬ª</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 30px auto;
      line-height: 1.4;
      padding: 0 15px;
    }
    h1 { text-align: center; margin-bottom: 20px; }
    #stage {
      background: #f0f0f0;
      padding: 20px;
      border-radius: 6px;
      font-size: 1.2rem;
      text-align: center;
      min-height: 60px;
    }
    #desc {
      background: #fafafa;
      padding: 15px;
      margin-top: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-line;
    }
    .controls {
      text-align: center;
      margin: 20px 0;
    }
    button {
      font-size: 1rem;
      padding: 8px 16px;
      margin: 0 8px;
    }
    #canvas {
      display: block;
      margin: 20px auto;
      background: #fff;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

  <h1>–û–±—É—á–µ–Ω–∏–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –Ω–∞ MNIST: —à–∞–≥ –∑–∞ —à–∞–≥–æ–º</h1>
  <div id="stage">–ù–∞–∂–º–∏ ¬´–ù–∞—á–∞—Ç—å¬ª</div>
  <div id="desc">–ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –ø—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–æ–≤ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è.</div>

  <div class="controls">
    <button id="startBtn">–ù–∞—á–∞—Ç—å</button>
    <button id="nextBtn" disabled>–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥</button>
    <button id="resetBtn" disabled>–°–±—Ä–æ—Å–∏—Ç—å</button>
  </div>

  <canvas id="canvas" width="700" height="300" style="display:none;"></canvas>

  <script>
    const steps = [
      {
        title: "–®–∞–≥ 1: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ç–∏ üñºÔ∏è‚ûîüß†",
        desc:
`–°–µ—Ç—å –¥–ª—è MNIST:
  ‚Ä¢ –í—Ö–æ–¥: 28√ó28=784 –ø–∏–∫—Å–µ–ª—è
  ‚Ä¢ –°–∫—Ä—ã—Ç—ã–µ —Å–ª–æ–∏: 128 ‚Üí 64
  ‚Ä¢ –í—ã—Ö–æ–¥: 10 —á–∏—Å–µ–ª (0‚Ä¶9)  
–≠–º–æ–¥–∑–∏: üñºÔ∏è ‚ûî [784‚Üí128‚Üí64‚Üí10] ‚ûî [0,1,‚Ä¶,9]`
      },
      {
        title: "–®–∞–≥ 2: Forward pass (–ø—Ä—è–º–æ–π –ø—Ä–æ—Ö–æ–¥)",
        desc:
`–í–æ–∑—å–º—ë–º –æ–¥–∏–Ω –ø—Ä–∏–º–µ—Ä:  
x[0]=0.2, x[1]=0.5, ‚Ä¶ (784 –∑–Ω–∞—á–µ–Ω–∏–π)  
W1[0] –ø—Ä–∏–º–µ—Ä: [0.1, ‚Äì0.2, ‚Ä¶]  
b1[0] = 0.0  
z1 = x¬∑W1[0] + b1[0] = 0.2¬∑0.1 + 0.5¬∑(‚Äì0.2) + ‚Ä¶ = ‚Äì0.08  
a1 = ReLU(z1) = max(0,‚Äì0.08) = 0.0  
‚Ä¶ (—Ç–∞–∫ –¥–ª—è –≤—Å–µ—Ö 128 –Ω–µ–π—Ä–æ–Ω–æ–≤)  
–≠–º–æ–¥–∑–∏: üèÄüéØ (—Ü–µ–ª–∏–º—Å—è –∏ –±—Ä–æ—Å–∞–µ–º ‚Üí —Å–º–æ—Ç—Ä–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç)`
      },
      {
        title: "–®–∞–≥ 3: Dropout 20% üôà",
        desc:
`–ü—É—Å—Ç—å p=0.2 ‚Üí keep=0.8  
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–∞—Å–∫—É –¥–ª—è 128 –Ω–µ–π—Ä–æ–Ω–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø–µ—Ä–≤—ã–µ 3: [1,0,1,‚Ä¶]  
a1_raw = [0.5,0.3,0.8,‚Ä¶]  
–ü–æ—Å–ª–µ Dropout:  
  a1[0]=0.5/0.8=0.625  
  a1[1]=0¬∑(—á—Ç–æ –±—ã–ª–æ)*‚Ä¶=0  
  a1[2]=0.8/0.8=1.0  
‚Ä¶  
–≠–º–æ–¥–∑–∏: üß†üôà (—á–∞—Å—Ç—å –Ω–µ–π—Ä–æ–Ω–æ–≤ ¬´—Å–ø–∏—Ç¬ª)`
      },
      {
        title: "–®–∞–≥ 4: BatchNorm üßπ",
        desc:
`–ë–µ—Ä—ë–º 3 –ø–µ—Ä–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å–ª–µ Dropout: [0.625,0,1.0]  
Œº = (0.625+0+1.0)/3 ‚âà0.542  
œÉ¬≤ = ((0.625‚Äì0.542)¬≤+‚Ä¶)/3 ‚âà0.081  
–ù–æ—Ä–º–∏—Ä—É–µ–º:  
  (0.625‚Äì0.542)/‚àö(0.081+Œµ) ‚âà0.29  
  (0‚Äì0.542)/‚Ä¶ ‚âà‚Äì1.90  
  (1.0‚Äì0.542)/‚Ä¶ ‚âà0.51  
‚Ä¶ (–¥–ª—è –≤—Å–µ—Ö 128)  
–≠–º–æ–¥–∑–∏: üßπüìö (—á–∏—Å—Ç–∏–º –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º)`
      },
      {
        title: "–®–∞–≥ 5: L2-—Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è ‚öñÔ∏è",
        desc:
`–í–µ—Å–æ–≤ –≤ —Å–µ—Ç–∏ –º–Ω–æ–≥–æ, –Ω–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –≤–æ–∑—å–º—ë–º 3: [0.1, ‚Äì0.2, 0.3]  
Œª = 0.01  
L2-—à—Ç—Ä–∞—Ñ = Œª¬∑‚àëw¬≤ = 0.01¬∑(0.01+0.04+0.09) = 0.0014  
–ò—Ç–æ–≥–æ–≤—ã–π Loss = –æ—Å–Ω–æ–≤–Ω–∞—è –æ—à–∏–±–∫–∞ + 0.0014  
–≠–º–æ–¥–∑–∏: üìè (—à—Ç—Ä–∞—Ñ—É–µ–º ¬´–∂–∞–¥–Ω—ã–µ¬ª –≤–µ—Å–∞)`
      },
      {
        title: "–®–∞–≥ 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Adam üèÉ‚Äç‚ôÇÔ∏è‚ö°",
        desc:
`–ü—É—Å—Ç—å —Ç–µ–∫—É—â–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç g=0.2  
Œ≤‚ÇÅ=0.9, Œ≤‚ÇÇ=0.999, Œµ=1e‚Äì8  
m = 0.9¬∑m_prev + 0.1¬∑g = 0.02  
v = 0.999¬∑v_prev + 0.001¬∑g¬≤ = 0.00004  
mÃÇ = m/(1‚Äì0.9¬π)=0.02/0.1=0.2  
vÃÇ = v/(1‚Äì0.999¬π)=0.00004/0.001=0.04  
lr=0.001  
ŒîW = ‚Äìlr¬∑mÃÇ/(‚àövÃÇ+Œµ) ‚âà ‚Äì0.001  
–ù–æ–≤—ã–π W = W_old + ŒîW  
–≠–º–æ–¥–∑–∏: üèîÔ∏èüß≠ (—É–º–Ω–æ —à–∞–≥–∞–µ–º –≤–Ω–∏–∑)`
      },
      {
        title: "–®–∞–≥ 7: Early Stopping üõë",
        desc:
`–≠–ø–æ—Ö–∏:                1     2     3     4     5     6
Train Loss:        [0.90, 0.70, 0.50, 0.40, 0.35, 0.34]
Val Loss:          [0.92, 0.75, 0.52, 0.42, 0.38, 0.39]  
–ù–∞ —ç–ø–æ—Ö–µ 6 Val Loss ‚Üë (0.39>0.38) ‚Üí —Å—Ç–æ–ø!  
–°–æ—Ö—Ä–∞–Ω—è–µ–º –º–æ–¥–µ–ª—å –ø–æ—Å–ª–µ —ç–ø–æ—Ö–∏ 5  
–≠–º–æ–¥–∑–∏: üï∞Ô∏è (–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–æ–≤—Ä–µ–º—è)`
      },
      {
        title: "–ò—Ç–æ–≥–æ–≤—ã–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è ‚úîÔ∏è",
        desc:
`1. –î–∞–Ω–Ω—ã–µ MNIST ‚ûî 784‚Äê–≤–µ–∫—Ç–æ—Ä  
2. Forward pass  
3. Dropout + BatchNorm  
4. Loss + L2 —à—Ç—Ä–∞—Ñ  
5. Backprop + Adam  
6. –ö–∞–∂–¥—ã–π epoch –ø—Ä–æ–≤–µ—Ä—è–µ–º Val Loss  
7. EarlyStopping –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞ –ª—É—á—à–µ–º  
–†–µ–∑—É–ª—å—Ç–∞—Ç: —Å–µ—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –±—ã—Å—Ç—Ä–æ –∏ —á–µ—Å—Ç–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç —Ü–∏—Ñ—Ä—ã!`
      }
    ];

    let cur = -1;
    const stageEl = document.getElementById('stage');
    const descEl  = document.getElementById('desc');
    const startBtn= document.getElementById('startBtn');
    const nextBtn = document.getElementById('nextBtn');
    const resetBtn= document.getElementById('resetBtn');
    const canvas  = document.getElementById('canvas');
    const ctx     = canvas.getContext('2d');

    function showStep() {
      const s = steps[cur];
      stageEl.textContent = s.title;
      descEl.textContent  = s.desc;
      // –ù–∞ —à–∞–≥–µ 7 ‚Äî –ø–æ–∫–∞–∂–µ–º –≥—Ä–∞—Ñ–∏–∫ Val vs Train
      if (cur === 6) {
        canvas.style.display = 'block';
        drawLossChart();
      } else {
        canvas.style.display = 'none';
      }
    }

    function drawLossChart() {
      // –ø—Ä–æ—Å—Ç–∞—è –ª–∏–Ω–∏—è –∫–∞–∫ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
      const train = [0.90,0.70,0.50,0.40,0.35,0.34];
      const val   = [0.92,0.75,0.52,0.42,0.38,0.39];
      const W=canvas.width, H=canvas.height;
      ctx.clearRect(0,0,W,H);
      // –æ—Å–∏
      ctx.strokeStyle='#888';
      ctx.beginPath();
      ctx.moveTo(40,H-30); ctx.lineTo(W-20,H-30);
      ctx.moveTo(40,20);   ctx.lineTo(40,H-30);
      ctx.stroke();
      // –ª–∏–Ω–∏–∏
      function x(i){ return 40 + i*(W-60)/(train.length-1); }
      function y(v){ return 20 + (1-v)*(H-50); }
      // train
      ctx.strokeStyle='#007ACC'; ctx.lineWidth=2;
      ctx.beginPath();
      train.forEach((v,i)=> i===0? ctx.moveTo(x(i),y(v)) : ctx.lineTo(x(i),y(v)));
      ctx.stroke();
      // val
      ctx.strokeStyle='#D62828'; ctx.beginPath();
      val.forEach((v,i)=> i===0? ctx.moveTo(x(i),y(v)) : ctx.lineTo(x(i),y(v)));
      ctx.stroke();
      // –ª–µ–≥–µ–Ω–¥–∞
      ctx.fillStyle='#007ACC'; ctx.fillRect(W-140,40,12,12);
      ctx.fillStyle='#000';     ctx.fillText('Train',W-120,50);
      ctx.fillStyle='#D62828'; ctx.fillRect(W-140,60,12,12);
      ctx.fillStyle='#000';     ctx.fillText('Val',W-120,70);
    }

    startBtn.onclick = ()=>{
      cur = 0; showStep();
      startBtn.disabled = true;
      nextBtn.disabled = false;
      resetBtn.disabled = false;
    };
    nextBtn.onclick = ()=>{
      if (cur < steps.length-1) cur++;
      showStep();
      if (cur === steps.length-1) nextBtn.disabled = true;
    };
    resetBtn.onclick = ()=>{
      cur = -1;
      stageEl.textContent = '–ù–∞–∂–º–∏ ¬´–ù–∞—á–∞—Ç—å¬ª';
      descEl.textContent  = '–ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –ø—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–æ–≤ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è.';
      canvas.style.display = 'none';
      startBtn.disabled = false;
      nextBtn.disabled = true;
      resetBtn.disabled = true;
    };
  </script>

</body>
</html>
