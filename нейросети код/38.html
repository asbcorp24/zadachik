<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Semi-Supervised Learning ¬´–¥–ª—è –¥—É—Ä–∞—á–∫–æ–≤¬ª</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 0 15px;
      line-height: 1.4;
    }
    h1, h2 { text-align: center; }
    #canvas {
      display: block;
      margin: 10px auto;
      background: #fff;
      border: 1px solid #ccc;
    }
    .controls {
      text-align: center;
      margin: 15px 0;
    }
    .controls button {
      margin: 0 6px;
      padding: 6px 12px;
      font-size: 1rem;
    }
    #log {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      font-family: monospace;
      white-space: pre-line;
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h1>Semi-Supervised Learning –¥–ª—è –¥—É—Ä–∞—á–∫–æ–≤</h1>
  <p style="text-align:center;">
    üìö –ï—Å—Ç—å –Ω–µ–º–Ω–æ–≥–æ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥ –∏ –∫—É—á–∞ –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏–π.<br>
    –ú—ã —É—á–∏–º—Å—è –Ω–∞ —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö, –ø–æ—Ç–æ–º —Å–∞–º–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ!
  </p>

  <h2>–ü—Ä–∏–º–µ—Ä: 2D-—Ç–æ—á–∫–∏</h2>
  <canvas id="canvas" width="400" height="400"></canvas>

  <div class="controls">
    <button id="step1">–®–∞–≥ 1: –û–±—É—á–∏—Ç—å—Å—è –Ω–∞ —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö</button>
    <button id="step2" disabled>–®–∞–≥ 2: –ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –Ω–∞ –Ω–µ—Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö</button>
    <button id="step3" disabled>–®–∞–≥ 3: –ü—Å–µ–≤–¥–æ-–º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ (thr=0.3)</button>
    <button id="step4" disabled>–®–∞–≥ 4: –î–æ–æ–±—É—á–µ–Ω–∏–µ</button>
    <button id="reset">–°–±—Ä–æ—Å–∏—Ç—å</button>
  </div>

  <div id="log">–ñ—É—Ä–Ω–∞–ª: –∂–º–∏—Ç–µ ¬´–®–∞–≥ 1¬ª.</div>

  <script>
  // === –î–∞–Ω–Ω—ã–µ ===
  const labeled = [
    {x:  80, y:  80, label: 'A'}, 
    {x: 100, y:  60, label: 'A'},
    {x:  60, y: 120, label: 'A'},
    {x: 300, y: 300, label: 'B'},
    {x: 320, y: 280, label: 'B'},
    {x: 280, y: 320, label: 'B'}
  ];
  const unlabeled = [
    {x: 200, y:  90, label: null},
    {x: 220, y: 120, label: null},
    {x: 120, y: 250, label: null},
    {x: 260, y: 200, label: null}
  ];
  let centroids = {};
  let predictions = [];  // { index, pred, dA, dB, conf }
  const threshold = 0.3;

  // === Canvas ===
  const canvas = document.getElementById('canvas'),
        ctx    = canvas.getContext('2d'),
        logEl  = document.getElementById('log');

  function draw() {
    ctx.clearRect(0,0,400,400);
    // Labeled
    labeled.forEach(p=>{
      ctx.fillStyle = p.label==='A'? '#e63946':'#457b9d';
      ctx.beginPath(); ctx.arc(p.x,p.y,6,0,2*Math.PI); ctx.fill();
    });
    // Unlabeled or now pseudo-labeled
    unlabeled.forEach(p=>{
      let color = '#999';
      if(p.label==='A') color='#e63946';
      if(p.label==='B') color='#457b9d';
      ctx.fillStyle = color;
      ctx.beginPath(); ctx.arc(p.x,p.y,6,0,2*Math.PI); ctx.fill();
      if(p.label===null){
        ctx.strokeStyle='#000'; ctx.setLineDash([4,2]);
        ctx.beginPath(); ctx.arc(p.x,p.y,8,0,2*Math.PI); ctx.stroke();
        ctx.setLineDash([]);
      }
    });
    // Centroids
    if(centroids.A){
      ctx.fillStyle='#e63946';
      ctx.fillRect(centroids.A.x-8,centroids.A.y-8,16,16);
    }
    if(centroids.B){
      ctx.fillStyle='#457b9d';
      ctx.fillRect(centroids.B.x-8,centroids.B.y-8,16,16);
    }
  }

  function log(msg){
    logEl.textContent = msg + '\n\n' + logEl.textContent;
  }

  // === –®–∞–≥ 1: –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö ===
  document.getElementById('step1').onclick = ()=>{
    // —Å—á–∏—Ç–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –¥–ª—è A –∏ B
    ['A','B'].forEach(cl=>{
      const pts = labeled.filter(p=>p.label===cl);
      const mx = pts.reduce((s,p)=>s+p.x,0)/pts.length;
      const my = pts.reduce((s,p)=>s+p.y,0)/pts.length;
      centroids[cl] = {x: mx, y: my};
    });
    draw();
    let msg = `–®–∞–≥ 1: –æ–±—É—á–∏–ª–∏—Å—å –Ω–∞ —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö.\n`+
              `–¶–µ–Ω—Ç—Ä–æ–∏–¥ A = (${centroids.A.x.toFixed(1)}, ${centroids.A.y.toFixed(1)})\n`+
              `–¶–µ–Ω—Ç—Ä–æ–∏–¥ B = (${centroids.B.x.toFixed(1)}, ${centroids.B.y.toFixed(1)})`;
    log(msg);
    document.getElementById('step2').disabled = false;
  };

  // === –®–∞–≥ 2: –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ –Ω–µ—Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö ===
  document.getElementById('step2').onclick = ()=>{
    predictions = unlabeled.map((p,i)=>{
      const dA = Math.hypot(p.x-centroids.A.x, p.y-centroids.A.y);
      const dB = Math.hypot(p.x-centroids.B.x, p.y-centroids.B.y);
      const conf = Math.abs(dA-dB)/(dA+dB);
      return { index: i, dA, dB, conf };
    });
    let msg = `–®–∞–≥ 2: –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ –Ω–µ—Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö.\n`;
    predictions.forEach(pr=>{
      msg += `  –¢–æ—á–∫–∞${pr.index}: dA=${pr.dA.toFixed(1)}, dB=${pr.dB.toFixed(1)}, `+
             `conf=${pr.conf.toFixed(2)}\n`;
    });
    log(msg);
    document.getElementById('step3').disabled = false;
  };

  // === –®–∞–≥ 3: –ø—Å–µ–≤–¥–æ-–º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ ===
  document.getElementById('step3').onclick = ()=>{
    let msg = `–®–∞–≥ 3: –ø—Å–µ–≤–¥–æ-–º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ (thr=${threshold})\n`;
    predictions.forEach(pr=>{
      if(pr.conf >= threshold){
        const lab = pr.dA<pr.dB? 'A':'B';
        unlabeled[pr.index].label = lab;
        msg += `  –¢–æ—á–∫–∞${pr.index} –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ ${lab} (conf=${pr.conf.toFixed(2)})\n`;
      } else {
        msg += `  –¢–æ—á–∫–∞${pr.index} –ù–ï –ø–æ–º–µ—á–µ–Ω–∞ (conf=${pr.conf.toFixed(2)})\n`;
      }
    });
    draw();
    log(msg);
    document.getElementById('step4').disabled = false;
  };

  // === –®–∞–≥ 4: –¥–æ–æ–±—É—á–µ–Ω–∏–µ —Å –ø—Å–µ–≤–¥–æ-–º–µ—Ç–∫–∞–º–∏ ===
  document.getElementById('step4').onclick = ()=>{
    // –¥–æ–±–∞–≤–ª—è–µ–º –ø—Å–µ–≤–¥–æ-–º–µ—Ç–∫–∏ –∫ labeled
    unlabeled.forEach(p=> {
      if(p.label) labeled.push({...p});
    });
    // –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ–º —Ü–µ–Ω—Ç—Ä–æ–∏–¥—ã
    ['A','B'].forEach(cl=>{
      const pts = labeled.filter(p=>p.label===cl);
      const mx = pts.reduce((s,p)=>s+p.x,0)/pts.length;
      const my = pts.reduce((s,p)=>s+p.y,0)/pts.length;
      centroids[cl] = {x: mx, y: my};
    });
    draw();
    let msg = `–®–∞–≥ 4: –¥–æ–æ–±—É—á–∏–ª–∏—Å—å —Å –ø—Å–µ–≤–¥–æ-–º–µ—Ç–∫–∞–º–∏.\n`+
              `–ù–æ–≤—ã–µ —Ü–µ–Ω—Ç—Ä–æ–∏–¥—ã:\n`+
              `  A = (${centroids.A.x.toFixed(1)},${centroids.A.y.toFixed(1)})\n`+
              `  B = (${centroids.B.x.toFixed(1)},${centroids.B.y.toFixed(1)})`;
    log(msg);
  };

  // === –°–±—Ä–æ—Å ===
  document.getElementById('reset').onclick = ()=>{
    // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    while(labeled.length>6) labeled.pop();
    unlabeled.forEach(p=> p.label = null);
    centroids = {};
    predictions = [];
    draw();
    logEl.textContent = '–ñ—É—Ä–Ω–∞–ª: –∂–º–∏—Ç–µ ¬´–®–∞–≥ 1¬ª.';
    document.getElementById('step2').disabled = true;
    document.getElementById('step3').disabled = true;
    document.getElementById('step4').disabled = true;
  };

  // initial draw
  draw();
  </script>
</body>
</html>
